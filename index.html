<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta name="msapplication-tap-highlight" content="no" />
    <meta content="author=Lei Kinsueng;organization=xuans;department=xuans network lab.yips;" />
    <meta content="baseon=望晴2_UI;version=6.7.0.1;" />
    <meta content="create-datetime=2015/2/3 Tue 22:45" />
    <meta content="copyright=祥琳健尚|Xuans 2015" />
    <meta content="code-name=雯晴|minQ;" />
    <meta content="slogon=创造力 创造 创造性;" />
    <meta content="minimal-ui" name="viewport">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <meta content="no" name="apple-mobile-web-app-capable" />
    <link rel="Shortcut Icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script>
        //console.log(window.screen.logicalXDPI);
        //console.log(window.screen.logicalYDPI);
        //
        //console.log(window.screen.availHeight+','+window.screen.availWidth);
        //判断屏幕大小
        var pcScreenMinWidth = 800, isPcScreen = false;
        if (window.screen.availWidth >= pcScreenMinWidth) {
            document.write('<link href=\"common\/jquery.mCustomScrollbar.min.css\" rel=\"stylesheet\" \/>');
            isPcScreen = true;
        }
    </script>
    <link href="common/style.css" rel="stylesheet" />
    <title>解忧集 | 祥琳健尚-望晴-望晴2_UI-雯晴|minQ</title>
</head>
<body style="opacity:0">
    <div class="bg-div">
        <canvas id="bgCanvas" style="display:none;"></canvas>
    </div>
    <header data-role="header" class="header">
        <ul class="header-titles no-select">
            <li class="title"><a href="/">祥琳健尚</a></li>
            <li class="title"><a href="/yips/yips.asp">望晴</a></li>
            <li class="title"><a href="./">雯晴minQ</a></li>
            <li id="mainTitle" class="title main-title">解忧集</li>
            <li class="func-btns">
                <button id="BtnAdd" class="title btn-add no-select">+<span class="info-name">&nbsp;添加</span></button>
            </li>
        </ul>
    </header>
    <div id="content" data-role="content">
        <aside class="aside">
            <ol class="aside-menu">
                <li data-id="1">
                    <dl class="writer-info">
                        <dt>第一位来信者</dt>
                        <dd title="苏苏，女，中国，河北，石家庄"><span class="info-name">基本信息：</span>苏苏，女，中国，河北，石家庄</dd>
                        <dd title="感情问题，与不喜欢的人在一起"><span class="info-name">主题：</span>感情问题，与不喜欢的人在一起</dd>
                    </dl>
                </li>
            </ol>
        </aside>
        <article class="article">
            <div id="defaultPage">
                <div class="default-page-title no-select title">解<br/>忧<br/>集</div>
                <p class="default-page-sub-title no-select">祥琳健尚&nbsp;希璇文学库</p>
                <p class="default-page-sub-title no-select">二〇一四甲午年&nbsp;八月</p>
            </div>
            <div id="addPage">
                <form id="addPageForm">
                    <h4 class="writer-info-input-title">基本信息</h4>
                    <ol class="writer-info-input-list">
                        <li>
                            <label class="writer-info-input-label">姓名</label>
                            <input type="text" name="writerName" id="writerName" placeholder="姓名" value="" class="writer-info-inputer" />
                        </li>
                        <li>
                            <label class="writer-info-input-label">性别</label>
                            <select id="writerIsMan" class="writer-info-inputer">
                                <option disabled="disabled" value="" selected="selected">请选择…</option>
                                <option value="0">男</option>
                                <option value="1">女</option>
                                <option value="2">未知</option>
                            </select>
                        </li>
                        <li>
                            <label class="writer-info-input-label">地区</label>
                            <input type="text" name="writerArea" id="writerArea" placeholder="地区" value="" class="writer-info-inputer" />
                        </li>
                    </ol>
                    <hr class="writer-info-input-hr" />
                    <h4 class="writer-info-input-title">主题</h4>
                    <ol class="writer-info-input-list">
                        <li>
                            <label class="writer-info-input-label">主题</label>
                            <input type="text" name="topicTitle" id="topicTitle" placeholder="主题" value="" class="writer-info-inputer" />
                        </li>
                    </ol>
                    <div class="writer-info-input-btn-group">
                        <button class="writer-info-input-btn btn" type="button">添加</button>
                    </div>
                </form>
            </div>
            <div id="dialogPage">

            </div>
        </article>
    </div>
    <footer data-role="footer">
        <ul class="footer-list no-select" >
            <li>祥琳健尚&copy;</li>
            <li>望晴</li>
            <li>2015</li>
            <li>雯晴minQ</li>
            <li>ナミヤ雑貨店</li>
        </ul>
        <p class="watermark no-select">
            ナミヤ雑貨店
        </p>
    </footer>
    <script src="common/jquery-1.11.2.js"></script>
    <script src="common/stackBlur.min.js"></script>
    <script type='text/javascript'>
        var titleWidths = new Array();
        var scrollbarElems = ['.aside', '.article'],
            scrollbarStyle = {
                axis: "y",
                scrollButtons: { enable: false },
                theme: "rounded",
            },
            pageElems = ['#defaultPage', '#addPage', '#dialogPage'];
        if (window.navigator.msPointerEnabled) {
            scrollbarStyle.theme = 'light-2';
        }
        var imagesCounts = 204, backgroundImage, bgImage = new Image(),isNotSupportFilter;
        if (isPcScreen) {
            //预加载图片
            var $bgDiv = $('.bg-div');
            isNotSupportFilter = !($bgDiv.css('-webkit-filter') || $bgDiv.css('-ms-filter') || $bgDiv.css('-moz-filter') || $bgDiv.css('filter') !== 'none');
            if (isNotSupportFilter && !document.getElementById('bgCanvas').style.display) {
                $bgDiv.css('background-image', "url('blur.svg')");
            } else {
                backgroundImage = document.location.pathname + 'images/%20%28' + ($.queryString('bgi') || parseInt(Math.random() * imagesCounts + 1, 0)) + '%29.jpg';
                bgImage.src = backgroundImage;
                bgImage.onload = function () {
                    if (isNotSupportFilter) {
                        //IE11不支持滤镜补丁
                        var bgImgElem = document.createElement('img');
                        bgImgElem.src = backgroundImage;
                        bgImgElem.id = 'bgImg';
                        bgImgElem.style.display = 'none';
                        document.body.appendChild(bgImgElem);
                        setTimeout(function () {
                            stackBlurImage("bgImg", 'bgCanvas', 6, true);
                            var $bgCanvas = $('#bgCanvas'),
                                bgCanvasWidth = $bgCanvas.width(),
                                bgCanvasProportion = (bgCanvasWidth / $bgCanvas.height()).toFixed(2);
                            $bgCanvas.css({
                                'height': '100%',
                                'width': 'auto',
                            }).fadeIn(500);
                            //IE10不支持width=auto start
                            if (bgCanvasProportion !== ($bgCanvas.width() / $bgCanvas.height()).toFixed(2)) {
                                alert('not-fixed');
                                $bgCanvas.css({
                                    'width': bgCanvasProportion*$bgCanvas.height()
                                });
                            }
                            $(window).resize(function () {
                                if (isPcScreen && isNotSupportFilter && $(this).width() > pcScreenMinWidth) {
                                    $bgCanvas.css({
                                        'width': bgCanvasProportion * $bgCanvas.height()
                                    });
                                }
                            });
                            //IE10不支持width=auto end
                        }, 1000);
                    }
                    backgroundImage = 'url(\'' + backgroundImage + '\')';
                    $bgDiv.css('background-image', backgroundImage);
                };
            }
            //PC屏幕大小下加载滚动条插件
            document.write('<script src=\"common\/jquery.mCustomScrollbar.concat.min.js\"><\/script>');
        }

        //onLoad & Listener
        $(function () {
            var hsl, hslp, isMainTitleHidden;
            /*修复inline-block空隙 Start*/
            $('.header-titles').contents().filter(function () {
                return this.nodeType === 3;
            }).remove();
            $('#content').contents().filter(function () {
                return this.nodeType === 3;
            }).remove();
            /*修复inline-block空隙 End*/
            /*设置header背景色 Start*/
            //$('body').hide();
            hsl = $.queryString('hsl') || document.location.replace('?hsl=' + parseInt(Math.random() * 361, 0) + '&bgi=' + parseInt(Math.random() * imagesCounts + 1, 0));
            //hsl = parseInt(Math.random() * 360, 0);
            hslp = 30;
            $('.header-titles li.title:not(:last)').each(function () {
                $(this).hslTorgba('background-color','hsl(' + hsl + ',50%,' + (hslp += 10) + '%)',hslp*.01);
            });
            $('header').hslTorgba('background-color', 'hsl(' + hsl + ',50%,' + (hslp += 10) + '%)', .5).fadeIn();
            $('aside').hslTorgba('background-color', 'hsl(' + hsl + ',50%,' + (hslp += 10) + '%)', .8);
            $('body').css({
                'background-color': 'hsl(' + hsl + ',50%,' + (hslp += 10) + '%)',
                'opacity': 1,
            }).fadeIn();
            /*设置header背景色 End*/
            /*设置header动画 Start*/
            $('.header-titles').click(function (e) {
                var $src = $(e.target || event.srcElement);
                if (!isMainTitleHidden && $(window).width() >= pcScreenMinWidth) {
                    isMainTitleHidden = true;
                    if ($src.hasClass('header-titles') || $src.hasClass('main-title')) {
                        //title
                        for (var i = 0, elemWidth,
                            elems = $('.header-titles li.title:not(:last)'),
                           $elem; !!($elem = $(elems[i])).length; i++) {
                            elemWidth = $elem.width();
                            $elem.animate({
                                'width': parseInt(elemWidth) > 0 ? (!titleWidths[i] ? titleWidths[i] = elemWidth : 0) && 0 : titleWidths[i]
                            });
                        }
                        //aside&article
                        var $asideElem = $(scrollbarElems[0]),
                            asideWidth = parseInt($asideElem.css('max-width'), 0) - parseInt($asideElem.css('width'), 0);
                        $asideElem.animate({
                            width: asideWidth,
                        });
                        $(scrollbarElems[1]).animate({
                            'width': $('#content').innerWidth() - asideWidth,
                            'max-width': $('#content').innerWidth() - asideWidth,
                        });
                    }
                    isMainTitleHidden = false;
                } else if ($(window).width() < pcScreenMinWidth) {
                    if ($src.hasClass('header-titles') || $src.hasClass('main-title')) {
                        for (var elem in scrollbarElems) {
                            $(scrollbarElems[elem]).toggleClass('aside-show');
                        }
                    }
                }
            });
            /*设置header动画 End*/
            /*设置屏幕宽度、高度 Start */
            var windowWidth=0, currentWindowWidth, resizeWidthTimer,resizeHeightTimer;
            $(window).resize(function () {
                if (isPcScreen) {
                    currentWindowWidth = $(this).width();
                    //处理屏幕宽度部分
                    if (currentWindowWidth >= pcScreenMinWidth) {
                        if (Math.abs(currentWindowWidth - windowWidth) > 100) {
                            clearTimeout(resizeWidthTimer);
                            windowWidth = currentWindowWidth;
                            resizeWidthTimer = setTimeout(resizeHeaderTitle, 200);
                        }
                    }
                    //处理屏幕高度部分
                    clearTimeout(resizeHeightTimer);
                    resizeHeightTimer = setTimeout(resizeContentSize, 200, currentWindowWidth);
                }
            });
            if (isPcScreen) {
                resizeHeaderTitle();
                resizeContentSize($(window).width());
            }
            /*设置屏幕宽度、高度 End */

            //IE下触屏滚动补丁
            if (!!$('body').css('-ms-touch-action') && window.navigator.msPointerEnabled) {
                for (var i = 0, elem; (elem = scrollbarElems[i]) != null; i++) {
                    $(elem)[0].onmspointerenter = function (innerEvent) {
                        if (innerEvent.which === 1 && $(this).hasClass('mCustomScrollbar')) {
                            $(this).mCustomScrollbar('destroy');
                            // console.log('destory');
                        } else if (innerEvent.which === 0 && !$(this).hasClass('mCustomScrollbar')) {
                            $(this).mCustomScrollbar(scrollbarStyle);
                            // console.log('create');
                        }
                    }
                }
            }

            //btn-add click
            $('#BtnAdd').click(function () {
                var i = 0, elem;

                //窄屏下隐藏aside
                for (; (elem = scrollbarElems[i]) != null; i++) {
                    $(elem).removeClass('aside-show');
                }
                //显示或影厂目录
                if ($(pageElems[1]).hasClass('addPage-show')) {
                    for (i = 0; (elem = pageElems[i]) != null; i++) {
                        $(elem).removeClass('addPage-show');
                    }
                    $('.bg-div').removeClass('deeper');
                } else {
                    for (i = 0; (elem = pageElems[i]) != null; i++) {
                        $(elem).removeClass('dialogPage-show').addClass('addPage-show');
                    }
                    $('.bg-div').addClass('deeper');
                }
                if (isPcScreen) {
                   // $(pageElems[1]).css('min-height', $(scrollbarElems[0]).innerHeight());
                    $(scrollbarElems[1]).mCustomScrollbar("update");
                }
            });

            //aside-menu click
            $('.aside-menu li').click(function () {
                console.log($(this).attr('data-id'));
            });
        });
        //resize headerTitle size
        function resizeHeaderTitle() {
            titleWidths.splice(0, titleWidths.length);
            $('.header-titles li.title:not(:last)').css('width', 'auto');
        }
        //resize #content size
        function resizeContentSize(windowWidth) {
            if (windowWidth > pcScreenMinWidth) {
                var contentHeight = $(window).innerHeight() - $('header').outerHeight() - $('footer').outerHeight();
                $('#content').css({
                    'height': contentHeight,
                    'max-height': contentHeight,
                    'opcacity': 0,
                });
                var contentWidth = $('#content').innerWidth() - $(scrollbarElems[0]).css('width', 'auto').outerWidth();
                $(scrollbarElems[1]).animate({
                    'width': contentWidth,
                    'max-width': contentWidth,
                });
                for (var elems in scrollbarElems) {
                    $(scrollbarElems[elems]).mCustomScrollbar(scrollbarStyle);
                    $(scrollbarElems[elems]).mCustomScrollbar("update");
                }
            } else {
                //恢复
                $('#content').css({
                    'height': 'auto',
                    'max-height': '100%',
                });
                $(scrollbarElems[0]).css({
                    'width': 'auto',
                    'max-width': 'auto',
                }).mCustomScrollbar("destroy");
                $(scrollbarElems[1]).css({
                    'width': 'auto',
                    'max-width': windowWidth,
                }).mCustomScrollbar("destroy");
                
            }
        }
    </script>
    <script>
        //ajax部分
        $(function () {

        });
    </script>


</body>
</html>
